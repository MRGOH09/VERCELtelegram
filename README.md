# 🎓 Learner Club - 记账习惯养成挑战系统

一个基于 Telegram Bot 的智能理财记账系统，专为 **Learner Club** 300人记账习惯养成挑战而设计。

## 🌟 项目亮点

### 📱 核心功能
- **智能记账系统**：支持收支记录、分类管理、预算控制
- **34天挑战体系**：3天预热赛 + 31天正式挑战
- **每日独特消息**：基于心理学设计的习惯养成激励文案
- **实时数据分析**：个人理财报告、分行排行榜
- **社群互动**：300人集体挑战，增强参与感

### 🎯 Learner Club 核心理念
1. **复利**：存下来的钱会成长
2. **行动力**：学了就要行动，被动+主动=行动力
3. **比例**：对的比例让你富
4. **转换力**：投资学习转换成收入更重要
5. **你不理财，财不理你**
6. **财商**：比智商情商逆商更重要

## 🚀 技术架构

### 后端技术栈
- **Runtime**: Node.js
- **Framework**: Vercel Serverless Functions
- **Database**: Supabase (PostgreSQL)
- **Bot Framework**: Telegram Bot API
- **Scheduler**: Vercel Cron Jobs

### 前端交互
- **Interface**: Telegram Bot 对话界面
- **Keyboards**: 自定义回复键盘和内联键盘
- **Multi-language**: 中文界面 (lib/i18n.js)

## 📅 挑战系统设计

### 🔥 预热赛阶段 (8月29-31日)
- **第1天**: 记账习惯预热开始，立即练习
- **第2天**: Learner Club理念完整介绍
- **第3天**: 正式挑战前心态调整

### 🎉 正式挑战阶段 (9月1-30日)
- **第1-7天**: 启动适应期 - 建立基础习惯
- **第8-14天**: 深入优化期 - 学习分析技巧  
- **第15-21天**: 巩固强化期 - 习惯内化
- **第22-30天**: 冲刺完成期 - 成就感强化

### 🧠 心理学设计
- **21天习惯养成理论**：科学依据支撑
- **里程碑庆祝**：第7、14、21、30天特别强调
- **社群归属感**：300人集体挑战氛围
- **成就词汇**：钻石、冠军、艺术家等激励用词

## 🛠️ 核心模块

### API 端点结构
```
/api/
├── telegram.js          # Telegram Webhook 处理
├── user/
│   └── user-system.js   # 用户管理和个人报告
├── records/
│   └── record-system.js # 记账记录管理
├── cron/
│   ├── daily-settlement.js  # 每日结算 (18:00)
│   └── morning-push.js      # 晨间推送 (08:00)
└── test-system.js       # 系统测试接口
```

### 核心库文件
```
/lib/
├── september-challenge-messages.js  # 34天挑战文案系统
├── monthly-budget.js               # 月度预算自动管理
├── daily-summary.js               # 日汇总计算
├── cron-utils.js                  # 定时任务工具
├── i18n.js                       # 多语言支持
├── state.js                      # 用户状态管理
├── telegram.js                   # Telegram API 工具
└── supabase.js                   # 数据库连接
```

## 📊 数据库设计

### 主要数据表
- **user_profile**: 用户基本信息和设置
- **user_month_budget**: 月度预算管理
- **daily_summary**: 每日支出汇总
- **expense_records**: 详细消费记录
- **leaderboard_daily**: 排行榜数据

### 数据约束和优化
- **预算约束**: a_pct ≤ 100 防止无效百分比
- **UPSERT操作**: 防止并发写入冲突
- **自动时间戳**: 记录创建和更新时间
- **索引优化**: 查询性能优化

## ⏰ 自动化任务

### Cron Jobs 配置
```json
{
  "crons": [
    { "path": "/api/cron/daily-settlement", "schedule": "0 18 * * *" },
    { "path": "/api/cron/morning-push", "schedule": "0 0 * * *" }
  ]
}
```

### 任务执行时间
- **日结算**: 每天 18:00 (UTC) / 02:00 (UTC+8)
- **晨间推送**: 每天 00:00 (UTC) / 08:00 (UTC+8)

## 🎮 用户交互流程

### 基础命令
- `/start` - 开始使用，设置个人信息
- `/record` - 记录支出
- `/my` - 查看个人理财报告
- `/history` - 查看历史记录
- `/help` - 获取帮助信息

### 智能对话流程
1. **用户注册**: 收入设置 → 预算比例分配 → 分行选择
2. **日常记账**: 金额输入 → 分类选择 → 确认记录
3. **数据查看**: 个人报告 → 预算使用率 → 历史趋势

## 📈 性能优化

### 批处理优化
- **月度预算**: 批量创建300用户预算，<6秒完成
- **晨间推送**: Promise.allSettled并发发送
- **错误恢复**: 失败重试机制

### 数据库优化
- **连接池**: Supabase连接管理
- **查询优化**: 索引和查询语句优化
- **约束检查**: 数据完整性保证

## 🔒 安全特性

### 数据安全
- **环境变量**: 敏感信息隔离
- **输入验证**: 防止SQL注入
- **权限控制**: 用户数据隔离
- **错误处理**: 详细日志记录

### 隐私保护
- **用户数据**: 仅存储必要信息
- **消息加密**: Telegram端到端加密
- **访问控制**: 基于chat_id的权限管理

## 🚀 部署配置

### 环境变量
```
TELEGRAM_BOT_TOKEN=your_bot_token
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_key
ADMIN_TG_IDS=admin_chat_ids
```

### Vercel部署
1. 连接GitHub仓库
2. 配置环境变量
3. 自动部署和监控
4. Cron任务自动执行

## 📊 监控和分析

### 系统监控
- **API性能**: 响应时间和成功率
- **Cron执行**: 定时任务执行状态
- **错误跟踪**: 详细错误日志
- **用户活跃**: 记账参与度分析

### 数据分析
- **挑战参与率**: 每日记账完成率
- **预算控制**: 用户预算使用情况
- **分类分析**: 支出类别分布
- **习惯形成**: 连续记账天数统计

## 🎯 8月测试模拟

为了提前体验系统效果，特别设计了8月测试期：
- **8月24-28日**: 模拟9月24-28日消息（接近完成阶段）
- **8月29-31日**: 预热赛实际体验
- **9月1-30日**: 正式31天挑战

## 🔄 版本历史

### v2.0 (2025-08-23) - Learner Club Challenge
- ✅ 实现34天挑战消息系统
- ✅ 融入Learner Club核心理念
- ✅ 月度预算自动创建
- ✅ 性能优化和错误修复
- ✅ 数据库约束完善

### v1.0 (2025-08-21) - 基础功能
- ✅ Telegram Bot基础框架
- ✅ 记账和查询功能
- ✅ 用户管理系统
- ✅ 定时任务框架

## 🤝 贡献指南

### 开发规范
请参考 `CLAUDE.md` 了解完整的开发规范：
- 重用优于重写
- 简单优于复杂
- 一致性优于创新

### 提交格式
- 使用清晰的提交信息
- 包含功能描述和影响范围
- 添加Claude Code生成标记

## 📞 联系信息

- **项目**: Learner Club 记账挑战
- **技术支持**: 通过GitHub Issues
- **用户反馈**: Telegram Bot内反馈

## 📜 许可证

本项目为 Learner Club 内部使用，专为300人记账习惯养成挑战设计。

---

🎓 **Learner Club**: 财商比智商情商逆商更重要！

🤖 *部分代码由 [Claude Code](https://claude.ai/code) 生成*