/**
 * 9月记账习惯养成挑战 - 每日动态消息系统
 * 为300人活动提供每天不同的激励消息
 */

// 获取挑战的第几天 (支持8月测试模拟)
export function getChallengeDay(date = new Date()) {
  const year = date.getFullYear()
  const month = date.getMonth() + 1 // JavaScript月份从0开始
  
  // 正式9月挑战 (9月1-30日 = 挑战第1-30天)
  if (year === 2025 && month === 9) {
    return date.getDate()
  }
  
  // 8月测试模拟
  if (year === 2025 && month === 8) {
    // 8月24-28日 模拟9月24-28日 (挑战第24-28天)
    if (date.getDate() >= 24 && date.getDate() <= 28) {
      return date.getDate() // 8月24日 = 挑战第24天
    }
    // 8月29-31日 = 预热第1-3天，映射为挑战第1-3天
    if (date.getDate() >= 29) {
      return date.getDate() - 28  // 8月29日 = 预热第1天
    }
  }
  
  return null // 不在挑战期间
}

// 8月预热赛消息 (8/29-31)
export const preheatingMessages = {
  1: '🔥 【预热赛第1天】记账习惯预热开始！\n\n🌟 欢迎参加预热赛！\n💪 与300位伙伴一起热身准备\n📱 试试 /record 熟悉记账流程\n📚 明天开始注册说明，后天正式挑战！\n\n🚀 预热赛，为正式挑战做准备！',
  
  2: '📋 【预热赛第2天】注册说明与准备日\n\n📝 今天重点：了解挑战规则\n🎯 熟悉记账分类和预算设置\n👥 与伙伴们交流经验\n📱 继续练习 /record 记录\n\n💡 准备充分，明天正式开战！',
  
  3: '🎪 【预热赛第3天】正式挑战前最后准备\n\n⚡ 明天开始31天正式挑战！\n🏆 预热赛让你已经领先一步\n📊 检查你的预算设置：/my\n🎯 心态调整：习惯养成马拉松开始\n\n🚀 准备就绪，明天见证奇迹！'
}

// 9月正式挑战消息 (9/1-30)
export const septemberChallengeMessages = {
  // 第一周：正式启动 (1-7天)
  1: '🎉 【正式挑战第1天】31天习惯养成正式开始！\n\n🌟 经过预热赛，你已经准备就绪！\n💪 与300位伙伴正式踏上习惯养成之路\n📱 继续用 /record 记录每一笔支出\n🏆 31天后，你将拥有全新的自己！\n\n🔥 正式挑战，全力以赴！',
  
  2: '🌅 【正式挑战第2天】昨天记录了吗？\n\n📝 记账小贴士：养成习惯需要重复\n🎯 今日任务：至少记录1笔支出\n👥 已有XXX位伙伴完成昨日记录！\n\n💡 坚持就是胜利！',
  
  3: '⭐ 【正式挑战第3天】你已经坚持3天了！\n\n🏆 恭喜！研究表明21天可以初步形成习惯\n📊 查看你的进度：/my\n🎊 每一天的坚持都很珍贵\n\n🚀 继续加油，习惯正在形成！',

  4: '💎 【正式挑战第4天】记账让财务更清晰\n\n💡 今日思考：昨天最大的支出是什么？\n🔍 分类记录帮你发现消费模式\n📈 理财意识正在提升！\n\n✨ 知识转化为行动，你做得很棒！',
  
  5: '🎯 【挑战第5天】工作日的理财自律\n\n☕ 上班族记账技巧：随手记录\n💼 午餐、交通、咖啡都是数据\n📱 用碎片时间养成好习惯\n\n👔 职场理财高手就是你！',
  
  6: '🌈 【挑战第6天】周末消费要留意\n\n🛍️ 休闲时光也要保持记账习惯\n🎬 娱乐支出同样需要记录\n⚖️ 享受生活，理性消费\n\n🎉 平衡是理财的艺术！',
  
  7: '🏁 【挑战第7天】第一周完成！\n\n🎊 恭喜完成第一周挑战！\n📊 本周数据：查看 /my 了解详情\n🏆 你已经超越了很多人\n\n💪 习惯养成路上，你走得很稳！',

  // 第二周：深入与优化 (8-14天)
  8: '🚀 【挑战第8天】第二周开始！\n\n📈 进阶目标：分析支出模式\n🔍 哪个类别花费最多？\n💡 数据驱动的理财决策\n\n🧠 从记录到分析，你在进步！',
  
  9: '💰 【挑战第9天】预算控制初体验\n\n🎯 查看你的预算使用率\n📊 开销控制在目标内了吗？\n⚖️ 适度调整消费行为\n\n🏹 精准控制，理财高手！',
  
  10: '🌟 【挑战第10天】双数日的坚持\n\n🔟 10天坚持不容易！\n💎 习惯正在内化\n📝 记账已经成为日常\n\n🎯 目标明确，执行有力！',
  
  11: '🎨 【挑战第11天】个性化理财\n\n🎭 每个人的消费模式都不同\n📊 发现属于你的理财节奏\n🎪 理财也可以很有趣\n\n🌈 找到适合自己的方式！',
  
  12: '⚡ 【挑战第12天】效率记账法\n\n⏰ 快速记录的小技巧\n📱 利用分类简化流程\n🎯 高效习惯助力成功\n\n🚀 速度与准确度并重！',
  
  13: '🎊 【挑战第13天】社群的力量\n\n👥 300人一起努力的感觉如何？\n🤝 共同目标凝聚力量\n🏆 一起成长更有动力\n\n💪 团队精神，共同进步！',
  
  14: '🎉 【挑战第14天】两周里程碑！\n\n🏆 两周坚持，值得庆祝！\n📈 习惯强度大幅提升\n🌟 你已经是记账达人了\n\n🎯 下半程，继续精彩！',

  // 第三周：巩固与提升 (15-21天)
  15: '🔥 【挑战第15天】习惯巩固期\n\n🧠 神经科学：15天重复强化习惯\n💎 你的大脑已经适应记账\n🎯 现在是自然而然的行为\n\n⚡ 习惯的力量正在显现！',
  
  16: '📊 【挑战第16天】数据洞察力\n\n🔍 从数据中发现消费趋势\n📈 哪些支出可以优化？\n💡 理财决策基于事实\n\n🎓 你已经是数据分析师了！',
  
  17: '🎯 【挑战第17天】目标调整期\n\n⚖️ 根据实际情况调整预算\n📊 数据指导理财策略\n🎪 灵活应对，智慧理财\n\n🧭 方向正确，持续前行！',
  
  18: '💡 【挑战第18天】理财智慧\n\n🧠 知识积累转化为智慧\n📚 每天记账都是学习\n🎭 理财是人生重要技能\n\n🌟 智慧理财，精彩人生！',
  
  19: '🌈 【挑战第19天】平衡艺术\n\n⚖️ 储蓄与消费的平衡\n🎨 理财如艺术创作\n💎 找到属于你的节奏\n\n🎪 生活需要平衡之美！',
  
  20: '⭐ 【挑战第20天】星光闪耀\n\n🌟 20天坚持，你是明星！\n🏆 超过80%的人都没做到\n💪 自律给你自由\n\n✨ 闪闪发光的你！',
  
  21: '🎊 【挑战第21天】习惯养成日！\n\n🧠 科学研究：21天初步形成习惯\n🎯 记账已经成为你的一部分\n🏆 这是一个重要的里程碑\n\n🎉 恭喜！习惯养成成功！',

  // 第四周：强化与展望 (22-28天)
  22: '💪 【挑战第22天】习惯强化期\n\n🔥 继续强化你的好习惯\n📈 每天记录让习惯更稳固\n🎯 目标：让记账变成本能\n\n⚡ 强者之路，永不止步！',
  
  23: '🌟 【挑战第23天】经验分享\n\n💡 你有什么记账心得吗？\n🎭 每个人的感悟都珍贵\n📚 经验是最宝贵的财富\n\n🎓 你已经是专家级了！',
  
  24: '🎯 【挑战第24天】精确控制\n\n🎪 精准记录，精确控制\n📊 数据让决策更明智\n💎 细节决定成败\n\n🏹 精准是高手的标志！',
  
  25: '🚀 【挑战第25天】冲刺阶段\n\n🏃‍♀️ 最后冲刺，保持节奏\n🎯 好习惯需要持续维护\n🏆 胜利就在前方\n\n💨 冲刺吧，理财达人！',
  
  26: '💎 【挑战第26天】钻石品质\n\n💍 26天坚持，品质如钻石\n🌟 坚持让你与众不同\n🎊 每一天都值得骄傲\n\n✨ 你就是最亮的星！',
  
  27: '🎨 【挑战第27天】理财艺术家\n\n🎭 理财是一门艺术\n📊 数字中蕴含美学\n🌈 创造属于你的财富画卷\n\n🖼️ 你的理财作品很精彩！',
  
  28: '🏆 【挑战第28天】冠军风范\n\n👑 28天坚持，冠军风范\n💪 自律是最好的天赋\n🎯 成功者的日常\n\n🏅 你就是自己的冠军！',

  // 最后两天：总结与展望 (29-30天)
  29: '🎊 【挑战第29天】即将胜利！\n\n🏁 明天就是最后一天了\n🏆 29天的坚持即将收获\n💎 你已经证明了自己\n\n🎉 胜利就在明天！',
  
  30: '🎉 【挑战第30天】圆满成功！🎉\n\n🏆 恭喜你完成30天挑战！\n👑 你已经是记账习惯的主人\n💎 这个月的坚持改变了你\n🌟 好习惯将伴随你一生\n\n🎊 为自己鼓掌！你太棒了！'
}

// 获取当日的挑战消息
export function getTodaysChallengeMessage(date = new Date()) {
  const year = date.getFullYear()
  const month = date.getMonth() + 1
  const dateNum = date.getDate()
  const day = getChallengeDay(date)
  
  if (!day) {
    return null // 不在挑战期间
  }
  
  // 8月测试模拟
  if (year === 2025 && month === 8) {
    // 8月24-28日 -> 模拟9月24-28日正式挑战消息
    if (dateNum >= 24 && dateNum <= 28) {
      return septemberChallengeMessages[day] || null
    }
    // 8月29-31日 -> 预热赛消息
    if (dateNum >= 29) {
      return preheatingMessages[day] || null
    }
  }
  
  // 9月正式挑战消息 (9/1-30 -> day 1-30)  
  if (year === 2025 && month === 9) {
    return septemberChallengeMessages[day] || null
  }
  
  return null
}

// 在morning_rank消息前添加挑战消息
export function addChallengeMessageToMorningRank(originalMessage, date = new Date()) {
  const challengeMessage = getTodaysChallengeMessage(date)
  
  if (!challengeMessage) {
    return originalMessage // 不在挑战期间，返回原消息
  }
  
  // 将挑战消息放在最前面，用分隔线分开
  return `${challengeMessage}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n${originalMessage}`
}

// 检查是否在9月挑战期间
export function isInSeptemberChallenge(date = new Date()) {
  return getChallengeDay(date) !== null
}